#!/bin/bash

#
# Generated by Webintrinsics Clusterlite:
# __COMMAND__
#
# Parameters: __PARSED_ARGUMENTS__
#
# Prerequisites:
# - Docker engine
# - Internet connection
#

set -e

install_weave() {
__WEAVE_DOWNLOAD_PART__
    echo "__LOG__ installing weave network"
    export CHECKPOINT_DISABLE=1 # disabling weave check for new versions
    export WEAVE_VERSION=1.9.5 # setting specific version to install

    # launching weave node with encryption and fixed set of seeds
    weave launch --password __TOKEN__ __SEEDS__

    weave prime # waiting for quorum consistency
}

install_volume() {
    echo "__LOG__ installing data directory"
    # creating reference to volume directory
    mkdir /var/lib/clusterlite || echo ""
    echo __VOLUME__ > /var/lib/clusterlite/volume.txt
    # setting up volume directory
    mkdir __VOLUME__ || echo ""
    mkdir __VOLUME__/clusterlite || echo ""
    echo __CONFIG__ > __VOLUME__/clusterlite.json
    echo "{}" > __VOLUME__/placements.json
}

run() {
    install_weave
    install_volume
}
run
echo "__LOG__ done"

